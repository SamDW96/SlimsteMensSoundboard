<!DOCTYPE html>
<html lang="nl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Slimste Mens Soundboard</title>

    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1a1a1a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="img/icon.jpg">

    <!-- External Libs -->
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,1,0" />

    <!-- Local Styles & Scripts -->
    <link rel="stylesheet" href="css/style.css">
    <script src="js/script.js" defer></script>

    <!-- Preload Critical Assets -->
    <link rel="preload" href="audio/leader.mp3" as="audio">
    <link rel="preload" href="audio/clock.mp3" as="audio">
</head>

<body>

    <div id="toast-container"></div>

    <div id="remote-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2>Remote Connect</h2>
            <div id="remote-menu">
                <button class="modal-btn btn-host" onclick="setupHost()">Host (Controle)</button>
                <button class="modal-btn btn-join" onclick="setupJoin()">Join (Ontvanger)</button>
            </div>
            <div id="connected-menu" class="hidden">
                <p style="color: #2ecc71; font-weight: bold;">Status: Verbonden âœ…</p>
                <button class="modal-btn btn-disconnect" onclick="disconnectRemote()">Verbinding Verbreken</button>
                <button class="modal-btn btn-cancel" onclick="closeModal()">Sluiten</button>
            </div>
            <div id="host-screen" class="hidden">
                <p>Deel deze code:</p>
                <div class="code-display" id="host-code-display">...</div>
                <p id="host-status" style="font-size: 0.8rem; color: #aaa;">Wachten op verbinding...</p>
                <button class="modal-btn btn-back" onclick="showRemoteMenu()">Terug</button>
            </div>
            <div id="join-screen" class="hidden">
                <p>Voer Host code in:</p>
                <input type="text" id="join-code-input" class="code-input" placeholder="CODE" maxlength="4">
                <button class="modal-btn btn-join" onclick="connectToHost()">Verbinden</button>
                <button class="modal-btn btn-back" onclick="showRemoteMenu()">Terug</button>
            </div>
            <button class="modal-btn btn-cancel" id="btn-main-cancel" onclick="cancelAndClose()">Annuleren</button>
        </div>
    </div>

    <div id="client-start-screen" class="hidden">
        <h1 style="color:var(--text-color); margin-bottom: 20px;">Klaar voor ontvangst</h1>
        <button class="pulse-btn" onclick="activateClientAudio()">KLIK OM TE STARTEN</button>
        <p style="color:var(--text-color); margin-top:20px; opacity:0.7;">Wacht op signaal...</p>
    </div>

    <div class="container">
        <div class="settings-bar">
            <div class="settings-left">
                <button class="icon-btn" id="btn-theme-toggle"><span class="material-symbols-rounded"
                        id="theme-icon">brightness_auto</span></button>
                <button class="icon-btn" id="btn-remote-toggle" onclick="openModal()"><span
                        class="material-symbols-rounded" id="remote-icon">cast</span></button>
            </div>
            <div class="volume-control">
                <div id="btn-mute-toggle" style="cursor: pointer;"><span class="material-symbols-rounded"
                        id="volume-icon">volume_up</span></div>
                <input type="range" id="volume-slider" min="0" max="1" step="0.05" value="1">
            </div>
        </div>

        <div class="control-row">
            <button id="btn-leader" class="sound-btn">
                <div class="content-wrapper"><span class="label-large">Intro</span><span
                        class="label-small">leader</span></div>
                <div class="progress-fill" id="progress-leader"></div>
            </button>
            <button id="btn-bumper" class="sound-btn">
                <div class="content-wrapper"><span class="label-large">Thema</span><span
                        class="label-small">bumper</span></div>
            </button>
        </div>

        <div id="panel-clock" class="sound-btn">
            <div class="clock-top-section" id="clock-click-target">
                <span class="label-large">Klok</span><span id="clock-timer">00:00</span>
            </div>
            <div class="auto-stop-container" id="auto-stop-wrapper">
                <span class="auto-stop-label">Auto-stop</span>
                <div class="auto-stop-btn" data-time="10">10s</div>
                <div class="auto-stop-btn" data-time="30">30s</div>
                <div class="auto-stop-btn" data-time="60">1m</div>
            </div>
            <div class="clock-actions-wrapper" id="clock-actions">
                <button id="btn-juist" class="action-btn">Juist</button>
                <button id="btn-fout" class="action-btn">Fout</button>
                <button id="btn-stop" class="action-btn">Stop</button>
            </div>
        </div>

        <button id="btn-finale" class="sound-btn" style="flex: 0 0 120px;">
            <div class="content-wrapper"><span class="label-large">Finale</span></div>
        </button>
    </div>

    <script>
        // Use inline script to register SW to avoid path issues or simply for clarity
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('Service Worker registered', reg))
                    .catch(err => console.error('Service Worker registration failed', err));
            });
        }
    </script>
</body>

</html>